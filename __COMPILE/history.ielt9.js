/*

 history API JavaScript Library v3.0.1 beta

 Support: IE6+, FF3+, Opera 9+, Safari, Chrome

 Copyright 2011-2012, Dmitriy Pakhtinov ( spb.piksel@gmail.com )

 http://spb-piksel.ru/

 Dual licensed under the MIT and GPL licenses:
   http://www.opensource.org/licenses/mit-license.php
   http://www.gnu.org/licenses/gpl.html

 Update: 18-05-2012

 Forked https://github.com/termi | 19-05-2012

 TODO:
  1. Optional shims for IE < 9
  2. first onpopstate after page load fix in Chome and Safary (addEventListener already fixed)
*/
(function(i){var r=null;function y(a){return v?a?v.setItem("__hitoryapi__",z(a)):E(v.getItem("__hitoryapi__"))||{}:{}}function A(a,c,e){var f=a,d,b=0;try{Object.defineProperties(a,c)}catch(j){if(a.__defineGetter__)for(var g in c)w(c,g)&&(a.__defineGetter__(g,c[g].get),c[g].set&&a.__defineSetter__(g,c[g].set));if(e)return 0;b=1}if(!e&&b&&t){e="StaticClass"+K+t++;f=["Class "+e];b=0;"execVB"in i||execScript("Public history, onhashchange\nFunction execVB(c) ExecuteGlobal(c) End Function","VBScript");"VBCVal"in i||
execScript("Function VBCVal(o,r) If IsObject(o) Then Set r=o Else r=o End If End Function","VBScript");for(d in a)"toString"===d&&(b=1),f[f.length]="Public ["+d+"]";w(a,"toString")&&(b||(f[f.length]="Public [toString]"),c["(toString)"]={get:function(){return this.toString.call(this)}});for(d in c)if(w(c,d)&&(c[d].get&&(a["get "+d]=c[d].get,f.push("Public [get "+d+"]","Public "+("(toString)"===d?"Default ":"")+"Property Get ["+d+"]","Call VBCVal(me.[get "+d+"].call(me),["+d+"])\nEnd Property")),c[d].set))a["set "+
d]=c[d].set,b="Call me.[set "+d+"].call(me,v)\nEnd Property",f.push("Public [set "+d+"]","Public Property Let ["+d+"](v)",b,"Public Property Set ["+d+"](v)",b);f.push("End Class","Function "+e+"Factory()","Set "+e+"Factory=New "+e,"End Function");execVB(f.join("\n"));f=i[e+"Factory"]();for(d in a)f[d]=a[d];w(a,"toString")&&(f.toString=a.toString)}return f}function g(a){var c,e,f=b.href.split("#");c=(f.shift(),"#"+f.join("#"));var f=(c||"#").replace(RegExp("^#[/]?(?:"+p.type+")?"),""),d=(c=f.split("#")).shift(),
g=p.basepath+f,j=(e=(p.basepath+d).split("?")).shift(),i=e.join("?");e=a&&a.substring(0,1);var k=b.protocol+"//"+b.host,h=k;c=(0<c.length?"#":"")+c.join("#");a&&(j=l?b.pathname:j,h=/[a-z]+\:\/\//.test(a)?a:"/"===e?h+a:"?"===e?h+((0===j.indexOf("/")?"":"/")+j+a):"#"===e?(l?b.href:k+g).split("#").shift()+a:h+((0===j.indexOf("/")?"":"/")+j.replace(/[^\/]+$/g,"")+a));e=RegExp("^"+k+p.basepath+"(.*)","i").exec(a?h:k+g);return{e:f,c:p.type+d,href:g,pathname:j,search:i?"?"+i:"",hash:c,a:k+g,d:h,b:e&&e[1]||
""}}"use 1strict";var H=Function.prototype.bind||function(a,c){var b=this,f=G.call(arguments,1);return function(){return _Function_apply.call(b,a,f.concat(G.call(arguments)))}},G=Array.prototype.slice,w=H.call(Function.prototype.call,Object.prototype.hasOwnProperty),o=i.history||{},b=i.location,l="pushState"in o,L=l&&void 0===o.state,q=b.href,I=o.pushState,J=o.replaceState,E=JSON.parse,z=JSON.stringify,v=i.sessionStorage,B=(/msie (\d+)/i.exec(navigator.userAgent)||[])[1],K=(new Date).getTime(),t=
!B||8<B?0:1,h=8>B?document.createElement("iframe"):0,C=0,p=function(a,b){if(b){if(m=b.src.split("?")[1])for(var e=0,f=m.split("&");f[e];)m=f[e++].split("="),a[m[0]]="true"==m[1]?1:"false"==m[1]?0:m[1]||"";b.id=""}return a}({basepath:"/",redirect:0,type:"/"},document.getElementById("history_uuid_8vhax7l")),n=!t&&o||{back:o.back,forward:o.forward,go:o.go,pushState:0,replaceState:0,emulate:!l,toString:function(){return"[object History]"}},x={state:{get:function(){return h&&h.storage||y()[n.location.href]||
r}},length:{get:function(){return o.length}},location:{set:function(a){i.location=a},get:function(){return l?b:D}}},D={assign:function(a){b.assign(l||0!==a.indexOf("#")?a:"#"+g().c+a)},reload:b.reload,replace:function(a){b.replace(l||0!==a.indexOf("#")?a:"#"+g().c+a)},toString:function(){return this.href}},N={href:{set:function(a){b.href=a},get:function(){return g().a}},protocol:{set:function(a){b.protocol=a},get:function(){return b.protocol}},host:{set:function(a){b.host=a},get:function(){return b.host}},
hostname:{set:function(a){b.hostname=a},get:function(){return b.hostname}},port:{set:function(a){b.port=a},get:function(){return b.port}},pathname:{set:function(a){b.pathname=a},get:function(){return g().pathname}},search:{set:function(a){b.search=a},get:function(){return g().search}},hash:{set:function(a){var a=0===a.indexOf("#")?a:"#"+a,c=g();h?a!=c.hash&&(n.pushState(0,0,c.c+a),M({oldURL:c.a})):b.hash="#"+c.c+a},get:function(){return g().hash}}},M=function(){function a(a){if(C)return j=g().a,C=
0;var b=a.oldURL||j,a=j=a.newURL||n.location.href;b.replace(/^.*?(#|$)/,"");a.replace(/^.*?(#|$)/,"");b!=a&&!d&&i.dispatchEvent(new Event("popstate"));q=d=0}function c(){if(q&&!(q=0)&&g().href!==p.basepath)clearInterval(h),setTimeout(H.call(i.dispatchEvent,i,new Event("popstate")),10)}var e=i.onpopstate||r,f=i.onhashchange||r,d=0,h=r,j=l?b.href:g().a;(l?b.hash:g().hash).replace(/^#/,"");i.addEventListener("hashchange",a);i.addEventListener("popstate",function(a){if(q===b.href)return a.stopImmediatePropagation(),
q=0;q=0;d=1});n=A(n,t?x:void 0===o.state?{state:x.state,location:x.location}:{location:x.location});D=A(D,N);!("onpopstate"in i||A(i,{onhashchange:{get:function(){return f},set:function(a){f=a||r}},onpopstate:{get:function(){return e},set:function(a){(e=a||r)&&!l&&c()}}},!0))&&!l&&(h=setInterval(function(){i.onpopstate&&c()},100));if(p.redirect&&0===i.parent.frames.length){var F=g(),k=b.search,u=b.pathname,s=p.basepath;if(l){if(F.href!=s&&RegExp("^"+s+"$","i").test(u)&&(b.href=F.href),!RegExp("^"+
s,"i").test(u))b.href=u.replace(/^\//,s)+k}else u!=s&&(b.href=s+"#"+u.replace(RegExp("^"+s,"i"),p.type)+k+b.hash)}return a}();n.pushState=function(a,c,e,f){var d=y(),h=n.location.href,j=e&&g(e);q=0;e=j?j.d:h;f&&d[h]&&delete d[h];if((!l||L)&&v&&a)d[e]=a,y(d),a=r;I&&J?f?J.call(n,a,c,e):I.call(n,a,c,e):j&&j.b!=g().b&&(C=1,f?b.replace("#"+p.type+j.b):b.hash=p.type+j.b)};n.replaceState=function(a,b,e){n.pushState(a,b,e,1)};t?(i.history=n,function(a,c){if(h){var e,f,d=function(){var a=g().a;c!=a&&(hashChangeEvent=
new Event("hashchange"),hashChangeEvent.oldURL=olcurrentHrefdUrl,hashChangeEvent.newURL=c=a,i.dispatchEvent(hashChangeEvent))};f=setInterval(d,100);h.src="javascript:true;";h=document.documentElement.firstChild.appendChild(h).contentWindow;n.pushState=e=function(a,i,k,l,n){var o=h.document,q=["<script>","lfirst=1;",,"storage="+z(a)+";","<\/script>"],k=k&&g(k);if(!k||!k.b)h.storage=a;else{n||clearInterval(f);if(l)h.lfirst?(history.back(),e(a,i,k.d,0,1)):(h.storage=a,b.replace("#"+p.type+k.b));else if(k.d!=
c||n)h.lfirst||(h.lfirst=1,e(h.storage,i,c,0,1)),q[2]='parent.location.hash="'+(p.type+k.b).replace(/"/g,'\\"')+'";',o.open(),o.write(q.join("")),o.close();n||(c=g().a,f=setInterval(d,100))}};i.attachEvent("unload",function(){if(h.storage){var a={};a[g().a]=h.storage;document.cookie="_historyAPI="+escape(z(a))}clearInterval(f)});if(1<a.length){a=unescape(a.pop().split(";").shift());try{h.storage=E(a)[g().a]}catch(l){}}}}(document.cookie.split("_historyAPI="),g().a)):i.history.emulate=!l})(window);