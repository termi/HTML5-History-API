/* Copyright 2011-2013, github.com/termi/HTML5-History-API, original by Dmitriy Pakhtinov ( spb.piksel@gmail.com ) */
(function(){"use strict";function E(a){var d=a||c.event,f=d.target||d.srcElement;a="defaultPrevented"in d?d.defaultPrevented:!1===d.returnValue;f&&"A"===f.nodeName&&!a&&(a=m(f.getAttribute("href",2),!0),a.b&&"#"!==a.b&&a.b===a.a.replace(m().a.split("#").shift(),"")&&(v=!0,history.location.hash=a.b,a=a.b.replace(/^#/,""),(f=document.getElementById(a))&&f.id===a&&f.scrollIntoView(),d.preventDefault?d.preventDefault():d.returnValue=!1))}function R(a,d,f,c){var e=f&&m(f);l&&(c||e&&e.a==m().a?z.call(this,a,d,f):w&&
e&&"/"==e.d?(A.call(this,a,d,f+"?"),z.call(this,a,d,f)):A.call(this,a,d,f));if(!M){d=F();var b=m().a,e=f&&m(f);r=!1;f=e?e.a:b;c&&d[b]&&delete d[b];H&&(d[f]=a,F(d))}!l&&e&&e.e!=m().e&&(v=!0,c?g.replace("#"+e.g):g.hash=e.g);a=m().c;q&&q==a||(B(3,q,a,!0),q=a)}function S(a,d,f){R.call(this,a,d,f,!0)}var c=this,k=c.history||{};if(!0!==k.__history_shim__){var b,h=document,X=h.documentElement,N=Function.prototype.call,I=Function.prototype.bind||!1,T=h.documentMode&&/msie (\d+)/i.test(navigator.userAgent),
w=(b=c.opera)&&"function"==typeof(b=b.version)&&+b(),n;c.addEventListener||(n={popstate:{},hashchange:{}},n.onpopstate=n.popstate,n.onhashchange=n.hashchange,n.onpagechange=n.pagechange={},b="attachEvent",c[b]=I.call(function(a,d,f){var b,e;d in n&&(e=n[d],(b=f.uuid)||(b=f.uuid="_"+ +new Date),e[b]||(e[b]=f));N.call(a,c,d,f,!1)},c,c[b]),b="detachEvent",c[b]=I.call(function(a,d,f){var b,e;d in n&&(b=f.uuid)&&(e=n[d])&&delete e[b];N.call(a,c,d,f,!1)},c,c[b]));b=c.JSON||{};var Y=b.parse,Z=b.stringify,
x=c.Event,U=I.call(N,Object.prototype.hasOwnProperty),s=(b=c.history)&&(b=b.__proto__||(b=b.constructor)&&b.prototype)&&b&&b!=Object.prototype&&b||c.history,g=c.location,r=!w&&!T&&g.href,A=k.pushState,z=k.replaceState,l=!(!A||!z),M=l&&"state"in k,H=c.sessionStorage,J=function(){var a=Object.defineProperty&&function(a,d){var b,c;for(c in d)U(d,c)&&(b=d[c],"object"!=typeof b&&(b={value:b}),"configurable"in b||(b.configurable=!0),Object.defineProperty(a,c,b))};if(a){try{a(s,{_:{get:function(){return 1},
configurable:!0}})}catch(d){a=null}1!==s._&&(a=null);"_"in s&&delete s._}!a&&s.__defineGetter__&&(a=function(a,d){var b,c;if(a.__defineGetter__)for(c in d)U(d,c)&&(b=d[c],b.get&&a.__defineGetter__(c,b.get),b.set&&a.__defineSetter__(c,b.set));return a});return a}(),O=void 0,$=/[^\/]+$/g,V=location.pathname.split("#")[0].split("?")[0],m=function(a){var d,b,c,e,G,k,h,aa=/^[^#]*/;return function(p,n){if(!p){if(p=g.href,!l||n)p=g.protocol+"//"+g.host+(-1!=p.indexOf("#")?"/":V)+((p.replace(aa,"")||"#").replace(/^#[\/]?(?:\/)?/,
"")||g.search)}else if(!l||O||T){var r=m(),q=r.d,s=r.l,t=p.charAt(0);p=/^(?:[\w0-9]+\:)?\/\//.test(p)?"/"==t?s+p:p:s+"//"+r.k+("/"==t?p:"?"==t?q+p:"#"==t?q+r.f+p:q.replace($,"")+p)}if(d!==p){a.href=d=p;k=a.port;G=a.host;h=a.pathname;if("http:"===a.protocol&&80==k||"https:"===a.protocol&&443==k)G=a.hostname,k="";h="/"==h.charAt(0)?h:"/"+h;b=h+a.search+a.hash;e=h+a.search;c=e+a.hash}return{a:a.protocol+"//"+G+b,l:a.protocol,k:G,n:a.hostname||g.hostname,o:k||g.port,d:h,f:a.search,b:a.hash,e:b,c:e,g:c}}}(h.createElement("a")),
y=!O&&s,t={state:{get:function(){return F()[this.location.href]}},length:{get:function(){return k.length}},location:{set:function(a){c.location.href=a},get:function(){return l?g:C}}},C={assign:function(a){g.assign(l||0!==a.indexOf("#")?a:"#"+m().c+a)},reload:g.reload,replace:function(a){g.replace(l||0!==a.indexOf("#")?a:"#"+m().c+a)},toString:function(){return this.href}},K={href:{set:function(a){g.href=a},get:function(){return m().a}},protocol:{set:function(a){g.protocol=a},get:function(){return g.protocol}},
host:{set:function(a){g.host=a},get:function(){return g.host}},hostname:{set:function(a){g.hostname=a},get:function(){return g.hostname}},port:{set:function(a){g.port=a},get:function(){return g.port}},pathname:{set:function(a){g.pathname=a},get:function(){return m().d}},search:{set:function(a){g.search=a},get:function(){return m().f}},hash:{set:function(a){a=0===a.indexOf("#")?a:"#"+a;var b=m();l?g.hash="#"+b.c+a:a!=b.b&&(k.pushState(null,null,b.c+a),D({oldURL:b.a}))},get:function(){return m().b}},
origin:{}},ba=function(a){if(!Object.defineProperty)return a;try{if(Object.defineProperty(a,"_",{get:function(){return 1},configurable:!0}),1===a._)return delete a._,a}catch(b){}var c=document.createElement("a"),g;for(g in c)try{delete c[g]}catch(e){}for(g in a)c[g]=a[g];return c},L=function(a,b,c){return J?(J(a,b),a):c?a:void 0},F=function(a){if(a)try{H.setItem("__history_shim__",Z(a))}catch(b){}else return H&&Y(H.getItem("__history_shim__"))||{}},B=function(a,b,f,g){var e=new x(2===a?"hashchange":
3===a?"pagechange":"popstate"),h;void 0!==b&&(e.oldUrl=b);void 0!==f&&(e.newUrl=f);e.__history_shim__=!0;if(!l&&void 0==a&&c.onpopstate)c.onpopstate(e);else 3===a&&(e.popstate=!g,W||"function"!==typeof(h=c.onpagechange)||h.call(c,e));if(c.dispatchEvent)c.dispatchEvent(e);else if(a=n[e.type])for(var k in a)a.hasOwnProperty(k)&&("function"===typeof(h=a[k])||h&&"object"===typeof h&&(h=h.handleEvent))&&h.call(c,e)},D,v=!1,W;(function(){function a(){r&&!(r=!1)&&s.e!==V&&(clearInterval(q),setTimeout(B,
10))}function d(a){a&&r===g.href&&(a.stopImmediatePropagation?a.stopImmediatePropagation():a.stopPropagation());r=!1;c.removeEventListener("popstate",d,!1);d=null}var f=c.onpopstate||null,n=c.onhashchange,e=!1,q=null,s=m(),u=s.a;D=function(a){if(!a.__history_shim__){var b=m();if(v)return u=b.a,v=!1;var c=a.oldURL||u;a=u=a.newURL||b.a;var b=c.replace(/^.*?(#|$)/,""),d=a.replace(/^.*?(#|$)/,"");c==a||e||B(void 0);r=e=!1;b!=d&&B(2,c,a)}};l?c.addEventListener&&("complite"!==h.readyState?(r?(c.addEventListener("popstate",
d,!1),c.addEventListener("load",function(){setTimeout(d,0)},!1)):d=null,c.addEventListener("popstate",function(a){r=!1;e=!0;w&&z.call(k,a.state,document.title,location.href)},!1)):r=!1):(c.addEventListener?c.addEventListener("hashchange",D,!1):c.attachEvent("onhashchange",D),void 0===n&&setInterval(function(){D({})},100),n||(n=null));t.__history_shim__={get:function(){return!0}};y&&((b=h.createElement("a"),b.href="http://g.g/%25","/%"===b.pathname)&&"URL"in h&&(t.location.get=function(){return C},
K.href.get=function(){return h.URL},K.pathname.get=function(){var a=this.href,b=this.hash,c=this.host;return a.substr(a.indexOf(c)+c.length).replace(this.search,"").replace(b,"")},M||(t.state.get=function(){return F()[c.location.href]})),b={},b.location=t.location,M||(b.state=t.state),b.__history_shim__=t.__history_shim__,L(y,b));C=L(J?ba(C):C,K);"onpopstate"in c||L(c,{onhashchange:{get:function(){return n},set:function(a){n=a||null}},onpopstate:{get:function(){return f},set:function(b){(f=b||null)&&
!l&&a()}}},!0)||l||(q=setInterval(function(){c.onpopstate&&a()},100));l||(document.addEventListener?document.addEventListener("click",E,!1):document.attachEvent("onclick",E))})();try{new x("click")}catch(ca){x=null}x||(x=function(a){var b;h.createEvent?(b=h.createEvent("Events"),b.initEvent(a,!1,!1)):(b=h.createEventObject(),b.type=a);return b});W=void 0!==X.dispatchEvent&&(!w||10<w)&&function(a){var b=!1;a.dispatchEvent&&(a.onpagechange=function(){b=!0},a.dispatchEvent(new x("pagechange")));return b}(document.createElement("_"));
y.pushState=R;y.replaceState=S;y.emulate=!l;l&&w&&Object.defineProperty&&Object.getOwnPropertyDescriptor&&((b=Object.getOwnPropertyDescriptor(c.location,"pathname"))&&(b.get=function(){var a=this.href,b=this.hash,c=this.host;return a.substr(a.indexOf(c)+c.length).replace(this.search,"").replace(b,"")}),b&&(c.Location&&c.Location.prototype&&Object.defineProperty(c.Location.prototype,"pathname",b),Object.defineProperty(c.location,"pathname",b)));var u=[],P=!1,Q=!1;l&&c.chrome&&(b=function(a){var b,
c;if(!1===l)!0===v?(c=!0,"hashchange"===a.type&&(v=!1)):"popstate"===a.type&&u.pop();else if(!0===P)for(P=!1,c=!0;b=u.shift();)A.call(k,b.h,b.i,b.j);else!0===Q&&(Q=!1,c=!0);c&&(a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation())},c.addEventListener("popstate",b,!0),c.addEventListener("hashchange",b,!0),b=function(){var a="fullscreenEnabled"in h?h.fullscreenEnabled:h.webkitIsFullScreen;if(a&&l)l=!1,document.addEventListener("click",E,!0),a=function(a,b){var c;A.call(this,
a,b,window.location.href);c=this.replaceState.__origin.apply(this,arguments);u.push({j:this.location.href,h:a,i:b});return c},a.__origin=k.pushState,k.pushState=a,a=function f(a,b){var c;z.call(this,a,b,window.location.href);c=f.__origin.apply(this,arguments);u[u.length-1]={j:this.location.href,h:a,i:b};return c},a.__origin=k.replaceState,k.replaceState=a,u=[];else if(!a&&!l){if(a=k.pushState.__origin)if(k.pushState=a,k.replaceState=k.replaceState.__origin,a=u.length)Q=P=!0,k.go(-1*a);l=!0;document.removeEventListener("click",
E,!0)}},h.addEventListener("webkitfullscreenchange",b),h.addEventListener("webkitfullscreenerror",b));var q=m().c;b=function(){var a=m().c;q&&q==a||B(3,q,q=a)};c.addEventListener?(c.addEventListener("popstate",b,!1),c.addEventListener("hashchange",b,!1)):(c.attachEvent("popstate",b),c.attachEvent("hashchange",b));b=O=L=J=I=t=K=s=y=S=null}}).call(window);
