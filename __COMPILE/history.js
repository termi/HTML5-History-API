/* Copyright 2011-2013, github.com/termi/HTML5-History-API, original by Dmitriy Pakhtinov ( spb.piksel@gmail.com ) */
(function(){"use strict";function J(a){var d=a||!1,e=d.target||!1;a=d.defaultPrevented;e&&"A"===e.nodeName&&!a&&(a=l(e.getAttribute("href",2),!0),a.b&&"#"!==a.b&&a.b===a.a.replace(l().a.split("#").shift(),"")&&(v=!0,history.location.hash=a.b,a=a.b.replace(/^#/,""),(e=document.getElementById(a))&&e.id===a&&e.scrollIntoView(),d.preventDefault()))}function P(a,d,e,b){var g=e&&l(e);k&&(b||g&&g.a==l().a?z.call(this,a,d,e):w&&g&&"/"==g.d?(A.call(this,a,d,e+"?"),z.call(this,a,d,e)):A.call(this,a,d,e));if(!K){d=D();var c=
l().a,g=e&&l(e);r=!1;e=g?g.a:c;b&&d[c]&&delete d[c];E&&(d[e]=a,D(d))}!k&&g&&g.e!=l().e&&(v=!0,b?f.replace("#"+g.g):f.hash=g.g);a=l().c;m&&m==a||(B(3,m,a,!0),m=a)}function Q(a,d,e){P.call(this,a,d,e,!0)}var c=this,h=c.history||{};if(!0!==h.__history_shim__){var b,q=document,W=q.documentElement,X=Function.prototype.call,R=Function.prototype.bind||!1,S=q.documentMode&&/msie (\d+)/i.test(navigator.userAgent),w=(b=c.opera)&&"function"==typeof(b=b.version)&&+b();b=c.JSON||{};var Y=b.parse,Z=b.stringify,
x=c.Event,T=R.call(X,Object.prototype.hasOwnProperty),s=(b=c.history)&&(b=b.__proto__||(b=b.constructor)&&b.prototype)&&b&&b!=Object.prototype&&b||c.history,f=c.location,r=!w&&!S&&f.href,A=h.pushState,z=h.replaceState,k=!(!A||!z),K=k&&"state"in h,E=c.sessionStorage,L=function(){var a=Object.defineProperty&&function(a,d){var b,c;for(c in d)T(d,c)&&(b=d[c],"object"!=typeof b&&(b={value:b}),"configurable"in b||(b.configurable=!0),Object.defineProperty(a,c,b))};if(a){try{a(s,{_:{get:function(){return 1},
configurable:!0}})}catch(d){a=null}1!==s._&&(a=null);"_"in s&&delete s._}!a&&s.__defineGetter__&&(a=function(a,d){var b,c;if(a.__defineGetter__)for(c in d)T(d,c)&&(b=d[c],b.get&&a.__defineGetter__(c,b.get),b.set&&a.__defineSetter__(c,b.set));return a});return a}(),M=void 0,$=/[^\/]+$/g,U=location.pathname.split("#")[0].split("?")[0],l=function(a){var d,b,c,g,h,C,u,q=/^[^#]*/;return function(n,r){if(!n){if(n=f.href,!k||r)n=f.protocol+"//"+f.host+(-1!=n.indexOf("#")?"/":U)+((n.replace(q,"")||"#").replace(/^#[\/]?(?:\/)?/,
"")||f.search)}else if(!k||M||S){var m=l(),s=m.d,t=m.l,p=n.charAt(0);n=/^(?:[\w0-9]+\:)?\/\//.test(n)?"/"==p?t+n:n:t+"//"+m.k+("/"==p?n:"?"==p?s+n:"#"==p?s+m.f+n:s.replace($,"")+n)}if(d!==n){a.href=d=n;C=a.port;h=a.host;u=a.pathname;if("http:"===a.protocol&&80==C||"https:"===a.protocol&&443==C)h=a.hostname,C="";u="/"==u.charAt(0)?u:"/"+u;b=u+a.search+a.hash;g=u+a.search;c=g+a.hash}return{a:a.protocol+"//"+h+b,l:a.protocol,k:h,n:a.hostname||f.hostname,o:C||f.port,d:u,f:a.search,b:a.hash,e:b,c:g,g:c}}}(q.createElement("a")),
y=!M&&s,t={state:{get:function(){return D()[this.location.href]}},length:{get:function(){return h.length}},location:{set:function(a){c.location.href=a},get:function(){return k?f:F}}},F={assign:function(a){f.assign(k||0!==a.indexOf("#")?a:"#"+l().c+a)},reload:f.reload,replace:function(a){f.replace(k||0!==a.indexOf("#")?a:"#"+l().c+a)},toString:function(){return this.href}},H={href:{set:function(a){f.href=a},get:function(){return l().a}},protocol:{set:function(a){f.protocol=a},get:function(){return f.protocol}},
host:{set:function(a){f.host=a},get:function(){return f.host}},hostname:{set:function(a){f.hostname=a},get:function(){return f.hostname}},port:{set:function(a){f.port=a},get:function(){return f.port}},pathname:{set:function(a){f.pathname=a},get:function(){return l().d}},search:{set:function(a){f.search=a},get:function(){return l().f}},hash:{set:function(a){a=0===a.indexOf("#")?a:"#"+a;var b=l();k?f.hash="#"+b.c+a:a!=b.b&&(h.pushState(null,null,b.c+a),G({oldURL:b.a}))},get:function(){return l().b}},
origin:{}},I=function(a,b,c){return L?(L(a,b),a):c?a:void 0},D=function(a){if(a)try{E.setItem("__history_shim__",Z(a))}catch(b){}else return E&&Y(E.getItem("__history_shim__"))||{}},B=function(a,b,e,f){var g=new x(2===a?"hashchange":3===a?"pagechange":"popstate"),h;void 0!==b&&(g.oldUrl=b);void 0!==e&&(g.newUrl=e);g.__history_shim__=!0;if(!k&&void 0==a&&c.onpopstate)c.onpopstate(g);else 3===a&&(g.popstate=!f,V||"function"!==typeof(h=c.onpagechange)||h.call(c,g));c.dispatchEvent(g)},G,v=!1,V;(function(){function a(b){b&&
r===f.href&&(b.stopImmediatePropagation?b.stopImmediatePropagation():b.stopPropagation());r=!1;c.removeEventListener("popstate",a,!1);a=null}var d=c.onpopstate||null,e=c.onhashchange,m=!1,g=l(),p=g.a;G=function(a){if(!a.__history_shim__){var b=l();if(v)return p=b.a,v=!1;var c=a.oldURL||p;a=p=a.newURL||b.a;var b=c.replace(/^.*?(#|$)/,""),d=a.replace(/^.*?(#|$)/,"");c==a||m||B(void 0);r=m=!1;b!=d&&B(2,c,a)}};k?c.addEventListener&&("complite"!==q.readyState?(r?(c.addEventListener("popstate",a,!1),c.addEventListener("load",
function(){setTimeout(a,0)},!1)):a=null,c.addEventListener("popstate",function(a){r=!1;m=!0;w&&z.call(h,a.state,document.title,location.href)},!1)):r=!1):(c.addEventListener("hashchange",G,!1),void 0===e&&setInterval(function(){G({})},100),e||(e=null));t.__history_shim__={get:function(){return!0}};y&&((b=q.createElement("a"),b.href="http://g.g/%25","/%"===b.pathname)&&"URL"in q&&(t.location.get=function(){return F},H.href.get=function(){return q.URL},H.pathname.get=function(){var a=this.href,b=this.hash,
c=this.host;return a.substr(a.indexOf(c)+c.length).replace(this.search,"").replace(b,"")},K||(t.state.get=function(){return D()[c.location.href]})),b={},b.location=t.location,K||(b.state=t.state),b.__history_shim__=t.__history_shim__,I(y,b));F=I(F,H);"onpopstate"in c||I(c,{onhashchange:{get:function(){return e},set:function(a){e=a||null}},onpopstate:{get:function(){return d},set:function(a){(d=a||null)&&!k&&r&&!(r=!1)&&g.e!==U&&(clearInterval(null),setTimeout(B,10))}}},!0);k||document.addEventListener("click",
J,!1)})();try{new x("click")}catch(aa){x=null}x||(x=function(a){var b;b=q.createEvent("Events");b.initEvent(a,!1,!1);return b});V=void 0!==W.dispatchEvent&&(!w||10<w)&&function(a){var b=!1;a.dispatchEvent&&(a.onpagechange=function(){b=!0},a.dispatchEvent(new x("pagechange")));return b}(document.createElement("_"));y.pushState=P;y.replaceState=Q;y.emulate=!k;k&&w&&Object.defineProperty&&Object.getOwnPropertyDescriptor&&((b=Object.getOwnPropertyDescriptor(c.location,"pathname"))&&(b.get=function(){var a=
this.href,b=this.hash,c=this.host;return a.substr(a.indexOf(c)+c.length).replace(this.search,"").replace(b,"")}),b&&(c.Location&&c.Location.prototype&&Object.defineProperty(c.Location.prototype,"pathname",b),Object.defineProperty(c.location,"pathname",b)));var p=[],N=!1,O=!1;k&&c.chrome&&(b=function(a){var b,c;if(!1===k)!0===v?(c=!0,"hashchange"===a.type&&(v=!1)):"popstate"===a.type&&p.pop();else if(!0===N)for(N=!1,c=!0;b=p.shift();)A.call(h,b.h,b.i,b.j);else!0===O&&(O=!1,c=!0);c&&(a.stopPropagation(),
a.stopImmediatePropagation&&a.stopImmediatePropagation())},c.addEventListener("popstate",b,!0),c.addEventListener("hashchange",b,!0),b=function(){var a="fullscreenEnabled"in q?q.fullscreenEnabled:q.webkitIsFullScreen;if(a&&k)k=!1,document.addEventListener("click",J,!0),a=function(a,b){var c;A.call(this,a,b,window.location.href);c=this.replaceState.__origin.apply(this,arguments);p.push({j:this.location.href,h:a,i:b});return c},a.__origin=h.pushState,h.pushState=a,a=function e(a,b){var c;z.call(this,
a,b,window.location.href);c=e.__origin.apply(this,arguments);p[p.length-1]={j:this.location.href,h:a,i:b};return c},a.__origin=h.replaceState,h.replaceState=a,p=[];else if(!a&&!k){if(a=h.pushState.__origin)if(h.pushState=a,h.replaceState=h.replaceState.__origin,a=p.length)O=N=!0,h.go(-1*a);k=!0;document.removeEventListener("click",J,!0)}},q.addEventListener("webkitfullscreenchange",b),q.addEventListener("webkitfullscreenerror",b));var m=l().c;b=function(){var a=l().c;m&&m==a||B(3,m,m=a)};c.addEventListener("popstate",
b,!1);c.addEventListener("hashchange",b,!1);b=M=I=L=R=t=H=s=y=Q=null}}).call(window);
